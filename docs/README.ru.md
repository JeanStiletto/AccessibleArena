# Accessible Arena

Мод доступности для Magic: The Gathering Arena, позволяющий слепым и слабовидящим игрокам играть с помощью экранного диктора. Полная навигация с клавиатуры, озвучивание всех состояний игры и локализация на 12 языков.

**Статус:** Публичная бета. Основной геймплей функционален. Остаются некоторые пограничные случаи и мелкие ошибки. См. Известные проблемы ниже.

**Примечание:** В настоящее время только клавиатура. Поддержки мыши или сенсорного ввода нет. Протестировано только на Windows 11 с NVDA. Другие версии Windows и экранные дикторы (JAWS, Narrator и т.д.) могут работать, но не тестировались.

## Возможности

- Полная навигация с клавиатуры для всех экранов (главная, магазин, мастерство, конструктор колод, дуэли)
- Интеграция с экранным диктором через библиотеку Tolk
- Чтение информации о картах стрелками (название, стоимость маны, тип, сила/выносливость, текст правил, художественный текст, редкость, художник)
- Полная поддержка дуэлей: навигация по зонам, бой, выбор целей, стек, браузеры (предвидение, наблюдение, маллиган)
- Объявления о связях привязки и боя (зачарован, блокирует, цель)
- Доступный магазин с опциями покупки и поддержкой диалогов оплаты
- Поддержка матчей с ботами для тренировки
- Меню настроек (F2) и меню помощи (F1) доступны везде
- 12 языков: английский, немецкий, французский, испанский, итальянский, португальский (BR), японский, корейский, русский, польский, китайский упрощённый, китайский традиционный

## Требования

- Windows 10 или новее
- Magic: The Gathering Arena (установленная через официальный установщик или Epic Games Store)
- Экранный диктор (рекомендуется NVDA: https://www.nvaccess.org/download/)
- MelonLoader (установщик обрабатывает это автоматически)

## Установка

### С помощью установщика (рекомендуется)

1. Скачайте `AccessibleArenaInstaller.exe` из последнего релиза на GitHub: https://github.com/JeanStiletto/AccessibleArena/releases/latest/download/AccessibleArenaInstaller.exe
2. Закройте MTG Arena, если она запущена
3. Запустите установщик. Он обнаружит вашу установку MTGA, установит MelonLoader при необходимости и развернёт мод
4. Запустите MTG Arena. Вы должны услышать «Accessible Arena v... запущен» через ваш экранный диктор

### Ручная установка

1. Установите MelonLoader в папку MTGA (https://github.com/LavaGang/MelonLoader)
2. Скачайте `AccessibleArena.dll` из последнего релиза
3. Скопируйте DLL в: `C:\Program Files\Wizards of the Coast\MTGA\Mods\`
4. Убедитесь, что `Tolk.dll` и `nvdaControllerClient64.dll` находятся в корневой папке MTGA
5. Запустите MTG Arena

## Быстрый старт

Если у вас ещё нет учётной записи Wizards, вы можете создать её на https://myaccounts.wizards.com/ вместо использования экрана регистрации в игре.

После установки запустите MTG Arena. Мод объявляет текущий экран через ваш экранный диктор.

- Нажмите **F1** в любое время для навигируемого меню помощи со списком всех горячих клавиш
- Нажмите **F2** для меню настроек (язык, подробность, сообщения обучения)
- Нажмите **F3**, чтобы услышать название текущего экрана
- Используйте **Стрелки вверх/вниз** или **Tab/Shift+Tab** для навигации по меню
- Нажмите **Enter** или **Пробел** для активации элементов
- Нажмите **Backspace** для возврата назад

## Горячие клавиши

### Меню

- Стрелка вверх/вниз (или W/S): Навигация по элементам
- Tab/Shift+Tab: Навигация по элементам (как стрелки вверх/вниз)
- Стрелка влево/вправо (или A/D): Управление каруселью и шаговыми элементами
- Home/End: Перейти к первому/последнему элементу
- Page Up/Page Down: Предыдущая/следующая страница в коллекции
- Enter/Пробел: Активировать
- Backspace: Назад

### Дуэли - Зоны

- C: Ваша рука
- G / Shift+G: Ваше кладбище / Кладбище оппонента
- X / Shift+X: Ваше изгнание / Изгнание оппонента
- S: Стек
- B / Shift+B: Ваши существа / Существа оппонента
- A / Shift+A: Ваши земли / Земли оппонента
- R / Shift+R: Ваши не-существа / Не-существа оппонента

### Дуэли - Внутри зон

- Влево/Вправо: Навигация по картам
- Home/End: Перейти к первой/последней карте
- Стрелка вверх/вниз: Чтение деталей карты при фокусе на ней
- I: Расширенная информация о карте (описания ключевых слов, другие стороны)
- Shift+Вверх/Вниз: Переключение рядов поля боя

### Дуэли - Информация

- T: Текущий ход и фаза
- L: Общее количество жизней
- V: Зона информации об игроке (Влево/Вправо для переключения игрока, Вверх/Вниз для свойств)
- D / Shift+D: Количество карт в вашей библиотеке / Библиотеке оппонента
- Shift+C: Количество карт в руке оппонента

### Дуэли - Действия

- Пробел: Подтвердить (передать приоритет, подтвердить атакующих/блокирующих, следующая фаза)
- Backspace: Отмена / отказ
- Tab: Переключение целей или выделенных элементов
- Ctrl+Tab: Переключение только целей оппонента
- Enter: Выбрать цель

### Дуэли - Браузеры (Предвидение, Наблюдение, Маллиган)

- Tab: Навигация по всем картам
- C/D: Перейти к верхней/нижней зоне
- Влево/Вправо: Навигация внутри зоны
- Enter: Переключить размещение карты
- Пробел: Подтвердить выбор
- Backspace: Отмена

### Глобальные

- F1: Меню помощи
- F2: Меню настроек
- F3: Объявить текущий экран
- Ctrl+R: Повторить последнее объявление
- Backspace: Универсальный возврат/закрытие/отмена

## Сообщить об ошибке

Если вы нашли ошибку, пожалуйста, откройте issue на GitHub: https://github.com/JeanStiletto/AccessibleArena/issues

Укажите следующую информацию:

- Что вы делали, когда произошла ошибка
- Что вы ожидали
- Что произошло на самом деле
- Ваш экранный диктор и его версия
- Приложите файл журнала MelonLoader: `C:\Program Files\Wizards of the Coast\MTGA\MelonLoader\Latest.log`

## Известные проблемы

- Клавиша Пробел для передачи приоритета не всегда работает надёжно (мод нажимает кнопку напрямую как запасной вариант)
- Карты в списке колоды конструктора показывают только название и количество, не полные детали
- Выбор типа очереди PlayBlade (Рейтинговая, Свободная игра, Brawl) не всегда устанавливает правильный режим игры

Полный список см. в docs/KNOWN_ISSUES.md.

## Устранение неполадок

**Нет голосового вывода после запуска игры**
- Убедитесь, что ваш экранный диктор запущен перед запуском MTG Arena
- Проверьте, что `Tolk.dll` и `nvdaControllerClient64.dll` находятся в корневой папке MTGA (установщик размещает их автоматически)
- Проверьте журнал MelonLoader в `C:\Program Files\Wizards of the Coast\MTGA\MelonLoader\Latest.log` на наличие ошибок

**Игра вылетает при запуске или мод не загружается**
- Убедитесь, что MelonLoader установлен.
- Если игра недавно обновлялась, может потребоваться переустановка MelonLoader или мода. Запустите установщик снова.
- Проверьте, что `AccessibleArena.dll` находится в `C:\Program Files\Wizards of the Coast\MTGA\Mods\`

**Мод работал, но перестал после обновления игры**
- Обновления MTG Arena могут перезаписать файлы MelonLoader. Запустите установщик снова для переустановки MelonLoader и мода.
- Если игра значительно изменила свою внутреннюю структуру, моду может потребоваться обновление. Проверьте наличие новых версий на GitHub.

**Горячие клавиши не работают**
- Убедитесь, что окно игры в фокусе (кликните по нему или используйте Alt+Tab)
- Нажмите F1, чтобы проверить, активен ли мод. Если вы слышите меню помощи, мод работает.
- Некоторые горячие клавиши работают только в определённых контекстах (горячие клавиши дуэли только во время дуэли)

**Неправильный язык**
- Нажмите F2, чтобы открыть меню настроек, затем используйте Enter для переключения языков

## Сборка из исходного кода

Требования: .NET SDK (любая версия, поддерживающая целевую платформу net472)

```
git clone https://github.com/JeanStiletto/AccessibleArena.git
cd AccessibleArena
dotnet build src/AccessibleArena.csproj
```

Собранная DLL будет в `src/bin/Debug/net472/AccessibleArena.dll`.

Ссылки на сборки игры ожидаются в папке `libs/`. Скопируйте эти DLL из вашей установки MTGA (`MTGA_Data/Managed/`):
- Assembly-CSharp.dll
- Core.dll
- UnityEngine.dll, UnityEngine.CoreModule.dll, UnityEngine.UI.dll, UnityEngine.UIModule.dll, UnityEngine.InputLegacyModule.dll
- Unity.TextMeshPro.dll, Unity.InputSystem.dll
- Wizards.Arena.Models.dll, Wizards.Arena.Enums.dll, Wizards.Mtga.Metadata.dll, Wizards.Mtga.Interfaces.dll
- ZFBrowser.dll

DLL MelonLoader (`MelonLoader.dll`, `0Harmony.dll`) берутся из вашей установки MelonLoader.

## Лицензия

Этот проект лицензирован под GNU General Public License v3.0. Подробности в файле LICENSE.

## Ссылки

- GitHub: https://github.com/JeanStiletto/AccessibleArena
- Экранный диктор NVDA (рекомендуется): https://www.nvaccess.org/download/
- MelonLoader: https://github.com/LavaGang/MelonLoader
- MTG Arena: https://magic.wizards.com/mtgarena
